#!/usr/bin/env bash

link_mysql() {
    local RECOVERY=${1-''}
    local FILE='my.sql'

    if [[ ! -z $RECOVERY ]] && [[ $RECOVERY == 'recovery' ]]; then
        FILE='my-recovery.cnf'
    fi

    echo -e "Linking $C10_DOTFILES/mysql/$FILE to /etc/my.cnf..."
    sudo ln -fs $C10_DOTFILES/mysql/$FILE /etc/my.cnf
}

usage() {
    echo -e "usage: mysql-deploy-conf [recovery]"
}

main() {
    local ARG=${1-''}

    # Sanitize the argument
    if [[ ! -z $ARG ]]; then
        if [[ $ARG == 'help' ]]; then
            usage
            exit 0
        elif [[ $ARG != 'recovery' ]]; then
            echo -e "\"$ARG\" argument unrecognized so it is ignored."
            usage
            echo
            ARG=''
        else
            echo -e "Activating mysql recovery mode...\n"
        fi
    fi

    link_mysql $1
}

main $1

echo -e "Restarting mysql..."
pkill -f mysql
mysql.server start

echo -e "Done!"
