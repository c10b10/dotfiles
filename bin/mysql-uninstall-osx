#!/usr/bin/env bash

read -p "Are you sure you want uninstall mysql? [y/n] " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]
then
    echo "Cancelled."
    exit 0
fi


uninstall_mysql() {
    local launch_file="$HOME/Library/LaunchAgents/homebrew.mxcl.mysql.plist"
    local steps=6

    echo "0/$steps: Killing all mysql processes..."
    pkill -f mysql

    echo "1/$steps: Removing mysql from homebrew..."
    brew remove mysql

    echo "2/$steps: Cleaning up homebrew..."
    brew cleanup

    echo "3/$steps: Trying to remove $launch_file from auto launch."
    if [[ -f $launch_file ]]; then
        launchctl unload -w $launch_file
    else
        echo "File missing, skipping this step."
    fi

    echo "4/$steps: Delete the auto launch file if it exists..."
    rm -f $launch_file

    echo "5/$steps: Remove the /usr/local/var/mysql dir..."
    sudo rm -rf /usr/local/var/mysql

    echo "6/$steps: Remove the /etc/my.cnf file..."
    sudo rm -f /etc/my.cnf
}

uninstall_mysql

echo "All done!"
