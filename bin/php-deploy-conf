#!/usr/bin/env bash
set -e

sanitize() {
    local PHP=${1-''}

    # exit if valid version is supplied
    if [[ ! -z $PHP ]]; then
        for i in ${ALL[@]}; do
            if [[ $i == $PHP ]]; then
                echo $PHP && return
            fi
        done
    fi

    echo $(php-installed)
}

deploy_php_conf() {
    local PHP=$1
    local PHP_VERSION=$(php-current-version 'pretty')

    local SRC=$C10_DOTFILES/php/${PHP}.ini
    local DEST=/usr/local/etc/php/$PHP_VERSION/php.ini
    if [[ -f $SRC ]] && [[ -d "$(dirname $DEST)" ]]; then
        sudo cp -i $SRC $DEST
        echo -e "Deployed $SRC to $DEST."
    else
        echo -e "Couldn't deploy $SRC because either this file does not exist or $(dirname $DEST) does not exist."
    fi
}

set +e

INITIAL_PHP=$(php-current-version)

IFS=' ' read -ra WHAT <<< $(sanitize ${1-''})
for i in "${WHAT[@]}"; do
    php-switch-osx $i > /dev/null
    deploy_php_conf $i
done

php-switch-osx $INITIAL_PHP > /dev/null
echo -e "Done!"
